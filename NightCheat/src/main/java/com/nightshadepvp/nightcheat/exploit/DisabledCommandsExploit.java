package com.nightshadepvp.nightcheat.exploit;

import com.google.common.collect.ImmutableList;
import com.nightshadepvp.core.Rank;
import com.nightshadepvp.core.entity.NSPlayer;
import org.bukkit.entity.Player;
import org.bukkit.event.EventHandler;
import org.bukkit.event.player.PlayerCommandPreprocessEvent;

import java.util.List;

public class DisabledCommandsExploit extends Exploit {

    private List<String> bannedCommands;

    public DisabledCommandsExploit() {
        super("Disabled Commands");
        this.setViolationsToNotify(1);
        bannedCommands = ImmutableList.of("//calc", "//calculate", "/me", "/say", "");
    }


    @EventHandler
    public void onPreProcess(PlayerCommandPreprocessEvent event) {
        Player player = event.getPlayer();
        NSPlayer nsPlayer = NSPlayer.get(player);
        if (nsPlayer.hasRank(Rank.ADMIN)) return; //bypass
        String check;
        String message = event.getMessage();
        if(message.contains(" ")){
            String[] parts = message.split(" ");
            check = parts[0];
        }else{
            check = event.getMessage();
        }
        if(bannedCommands.contains(check.toLowerCase())){
            flag(player, this, "Tried to exploit a command (" + check.toLowerCase() + ")");
        }
    }
}
