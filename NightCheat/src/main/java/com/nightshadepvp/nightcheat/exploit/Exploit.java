package com.nightshadepvp.nightcheat.exploit;

import com.comphenix.protocol.ProtocolLibrary;
import com.comphenix.protocol.ProtocolManager;
import com.nightshadepvp.core.Rank;
import com.nightshadepvp.core.utils.ChatUtils;
import com.nightshadepvp.nightcheat.Advantage;
import com.nightshadepvp.nightcheat.ViolationManager;
import com.nightshadepvp.nightcheat.cheat.CheatManager;
import com.nightshadepvp.nightcheat.cheat.CheatType;
import org.bukkit.entity.Player;
import org.bukkit.event.Listener;

public abstract class Exploit implements Listener, Advantage {

    private String name;
    private boolean enabled;
    private int violationsToNotify;

    protected ExploitManager exploitManager;
    protected ViolationManager violationManager;
    protected ProtocolManager protocolManager = ProtocolLibrary.getProtocolManager();

    public Exploit(String name) {
        this.name = name;
    }

    public boolean isEnabled() {
        return enabled;
    }

    public void setEnabled(boolean enabled) {
        this.enabled = enabled;
    }

    public int getViolationsToNotify() {
        return violationsToNotify;
    }

    public void setViolationsToNotify(int violationsToNotify) {
        this.violationsToNotify = violationsToNotify;
    }

    public ExploitManager getExploitManager() {
        return exploitManager;
    }

    public void setExploitManager(ExploitManager exploitManager) {
        this.exploitManager = exploitManager;
    }

    public ViolationManager getViolationManager() {
        return violationManager;
    }

    public void setViolationManager(ViolationManager violationManager) {
        this.violationManager = violationManager;
    }

    public ProtocolManager getProtocolManager() {
        return protocolManager;
    }

    public void setProtocolManager(ProtocolManager protocolManager) {
        this.protocolManager = protocolManager;
    }

    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
    }

    @Override
    public void flag(Player player, Advantage advantage, String message) {
        this.violationManager.getPlayerViolation(player.getUniqueId()).incrementAdvantage(advantage, 1);
    }

    @Override
    public void log(Player player, String message) {
        if (violationManager.getPlayerViolation(player.getUniqueId()).getViolations(this) >= this.getViolationsToNotify()) {
            ChatUtils.broadcast("&8[&cNightCheat&8] &7" + player.getName() + " &7failed &b" + this.getName() + " &8[&4" + this.getViolationManager().getPlayerViolation(player.getUniqueId()).getViolations(this) + "&8]", Rank.TRIAL);
        }
        System.out.println("[NightCheat] " + player.getName() + " failed " + this.getName() + "[ " + this.getViolationManager().getPlayerViolation(player.getUniqueId()).getViolations(this) + "]");
    }
}
